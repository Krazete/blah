<!DOCTYPE html>
<meta charset="UTF-8">
<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.7.1/gl-matrix-min.js"></script>
        <script>
            function TrackballRotator(e,t,n,r,o){var a,i,c,l,u,m,v,d=new Array(3),s=new Array(3),g=new Array(3);function f(e,t){function n(e,t,n){var r=2*(e[0]*t[0]+e[1]*t[1]+e[2]*t[2]);n[0]=r*e[0]-t[0],n[1]=r*e[1]-t[1],n[2]=r*e[2]-t[2]}E(e,e),E(t,t);var r,o,a,i=[0,0,0];a=t,(r=i)[0]=(o=e)[0]+a[0],r[1]=o[1]+a[1],r[2]=o[2]+a[2],E(i,i);var c=[0,0,0];n(i,g,c),n(e,c,g),n(i,d,c),n(e,c,d),n(i,s,c),n(e,c,s)}this.setView=function(e,t,n){var r,o,i,c,l,u,m,v,f,h,p,_,A,L,b,R;g=void 0===t?[0,0,10]:t,n=void 0===n?[0,1,0]:n,a=e,E(g,g),o=g,(r=s)[0]=o[0],r[1]=o[1],r[2]=o[2],i=s,c=s,m=n,l=(u=g)[0]*m[0]+u[1]*m[1]+u[2]*m[2],i[0]=c[0]*l,i[1]=c[1]*l,i[2]=c[2]*l,f=n,h=s,(v=s)[0]=f[0]-h[0],v[1]=f[1]-h[1],v[2]=f[2]-h[2],E(s,s),p=d,A=g,L=(_=s)[1]*A[2]-_[2]*A[1],b=_[2]*A[0]-_[0]*A[2],R=_[0]*A[1]-_[1]*A[0],p[0]=L,p[1]=b,p[2]=R},this.getViewMatrix=function(){var e=[d[0],s[0],g[0],0,d[1],s[1],g[1],0,d[2],s[2],g[2],0,0,0,0,1];if(void 0!==i){var t=i[0]-e[0]*i[0]-e[4]*i[1]-e[8]*i[2],n=i[1]-e[1]*i[0]-e[5]*i[1]-e[9]*i[2],r=i[2]-e[2]*i[0]-e[6]*i[1]-e[10]*i[2];e[12]=t,e[13]=n,e[14]=r}return void 0!==a&&(e[14]-=a),e},this.getViewDistance=function(){return a},this.setViewDistance=function(e){a=e},this.getRotationCenter=function(){return void 0===i?[0,0,0]:i},this.setRotationCenter=function(e){i=e},this.setView(n,r,o),e.addEventListener("mousedown",function(t){if(h)return;h=!0,c=e.width/2,l=e.height/2;var n=Math.min(c,l);u=n*n,document.addEventListener("mousemove",p,!1),document.addEventListener("mouseup",_,!1);var r=e.getBoundingClientRect();m=t.clientX-r.left,v=t.clientY-r.top},!1),e.addEventListener("touchstart",function(t){if(1!=t.touches.length)return void b();t.preventDefault();var n=e.getBoundingClientRect();m=t.touches[0].clientX-n.left,v=t.touches[0].clientY-n.top,e.addEventListener("touchmove",A,!1),e.addEventListener("touchend",L,!1),e.addEventListener("touchcancel",b,!1),touchStarted=!0,c=e.width/2,l=e.height/2;var r=Math.min(c,l);u=r*r},!1);var h=!1;function p(n){if(h){var r=e.getBoundingClientRect(),o=n.clientX-r.left,a=n.clientY-r.top;f(R(m,v),R(o,a)),m=o,v=a,t&&t()}}function _(e){h&&(document.removeEventListener("mousemove",p,!1),document.removeEventListener("mouseup",_,!1),h=!1)}function A(n){if(1==n.touches.length&&touchStarted){n.preventDefault();var r=e.getBoundingClientRect(),o=n.touches[0].clientX-r.left,a=n.touches[0].clientY-r.top;f(R(m,v),R(o,a)),m=o,v=a,t&&t()}else b()}function L(e){b()}function b(){touchStarted&&(touchStarted=!1,e.removeEventListener("touchmove",A,!1),e.removeEventListener("touchend",L,!1),e.removeEventListener("touchcancel",b,!1))}function R(e,t){var n=e-c,r=l-t,o=n*d[0]+r*s[0],a=n*d[1]+r*s[1],i=n*d[2]+r*s[2],m=o*o+a*a+i*i;if(m>u)return[o,a,i];var v=Math.sqrt(u-m);return[o+v*g[0],a+v*g[1],i+v*g[2]]}function E(e,t){var n,r=(n=t,Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]));e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r}}var mapper,gl,ac_loc,an_loc,acb,anb,indexb,u_dc,u_sc,u_se,u_lp,u_mv,u_p,u_nm;function cryptCoord(e,t,n){return e+t*n}function luck(e,t,n){mapper=mapper||getLuck(e,t,n);var r=[],o=[],a=[],i={};function c(e,t,n){e in i?t in i[e]?n=i[e][t]:i[e][t]=n:(i[e]={},i[e][t]=n),r.push(e,t,n)}for(var l=0;l<t;l++)for(var m=0;m<n;m++)if(mapper.includes(cryptCoord(l,m,n))){var d=(l-t/2)*e,s=(m-n/2)*e;c(d,s,Math.random()*e),c(d+e,s,Math.random()*e),c(d,s+e,Math.random()*e),c(d+e,s+e,Math.random()*e),c(d,s+e,Math.random()*e),c(d+e,s,Math.random()*e)}for(var g=0;g<r.length/3;g++)u=[r[g+3]-r[g],r[g+4]-r[g+1],r[g+5]-r[g+2]],v=[r[g+6]-r[g],r[g+7]-r[g+1],r[g+8]-r[g+2]],o.push(u[1]*v[2]-u[2]*v[1]),o.push(u[2]*v[0]-u[0]*v[2]),o.push(u[0]*v[1]-u[1]*v[0]),a.push(g);return{vertexPositions:new Float32Array(r),vertexNormals:new Float32Array(o),indices:new Uint16Array(a)}}function getLuck(e,t,n){var r=document.createElement("canvas");r.width=t,r.height=n;var o=r.getContext("2d"),a=145*e;o.font="bold "+a+"pt Arial";var i="BIRTHDAY";o.fillText("HAPPY",(t-o.measureText("HAPPY").width)/2,n/2-3*a/2),o.fillText(i,(t-o.measureText(i).width)/2,n/2+a/2),o.fillText("ARJAY",(t-o.measureText("ARJAY").width)/2,n/2+5*a/2),document.body.appendChild(r);for(var c=[],l=0;l<t;l++)for(var u=0;u<n;u++)o.getImageData(l,u,1,1).data[3]>=128&&c.push(cryptCoord(l,n-u,n));return c}var mv,r,o,p=mat4.create(),nm=mat3.create();function draw(){gl.clearColor(6/255,39/255,67/255,1),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),mat4.perspective(p,Math.PI/5,1,10,20),mv=r.getViewMatrix(),mat3.normalFromMat4(nm,mv),gl.uniformMatrix3fv(u_nm,!1,nm),gl.uniformMatrix4fv(u_mv,!1,mv),gl.uniformMatrix4fv(u_p,!1,p),gl.drawElements(gl.TRIANGLES,o.indices.length,gl.UNSIGNED_SHORT,0)}function installModel(e){gl.bindBuffer(gl.ARRAY_BUFFER,acb),gl.bufferData(gl.ARRAY_BUFFER,e.vertexPositions,gl.STATIC_DRAW),gl.vertexAttribPointer(ac_loc,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(ac_loc),gl.bindBuffer(gl.ARRAY_BUFFER,anb),gl.bufferData(gl.ARRAY_BUFFER,e.vertexNormals,gl.STATIC_DRAW),gl.vertexAttribPointer(an_loc,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(an_loc),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexb),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,e.indices,gl.STATIC_DRAW)}function initGL(){var e=createProgram(gl,"vshader-source","fshader-source");gl.useProgram(e),ac_loc=gl.getAttribLocation(e,"ac"),an_loc=gl.getAttribLocation(e,"an"),u_mv=gl.getUniformLocation(e,"mv"),u_p=gl.getUniformLocation(e,"p"),u_nm=gl.getUniformLocation(e,"nm"),u_lp=gl.getUniformLocation(e,"lp"),u_dc=gl.getUniformLocation(e,"dc"),u_sc=gl.getUniformLocation(e,"sc"),u_se=gl.getUniformLocation(e,"se"),acb=gl.createBuffer(),anb=gl.createBuffer(),indexb=gl.createBuffer(),gl.enable(gl.DEPTH_TEST),gl.uniform3f(u_sc,1,1,1),gl.uniform4f(u_dc,161/256,187/256,209/256,1),gl.uniform1f(u_se,10)}function createProgram(e,t,n){var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,"uniform mat4 mv;uniform mat4 p;uniform mat3 nm;attribute vec3 ac;attribute vec3 an;varying vec3 b_coords;varying vec3 b_normal;void main(){vec4 coords=vec4(ac,1);vec4 eyeCoords=mv*coords;gl_Position=p*eyeCoords;b_coords=eyeCoords.xyz;b_normal=nm*an;}"),e.compileShader(r);document.body.parentElement.innerHTML.split("vshader-source")[0].split("\n").length,document.body.parentElement.innerHTML.split("fshader-source")[0].split("\n").length;var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform vec4 lp;uniform vec4 dc;uniform vec3 sc;uniform float se;varying vec3 b_coords;varying vec3 b_normal;void main(){vec3 N=normalize(b_normal);vec3 L;if (lp.w==0.0){L=normalize(lp.xyz);} else{L=normalize(lp.xyz/lp.w-b_coords);} vec3 R=normalize(2.0*N*dot(N,L)-L);vec3 V=normalize(-b_coords);vec4 ambientLight=0.1*dc;vec4 diffuseLight=0.8*dc*max(dot(N,L),0.0);vec3 specularLight=0.4*sc*pow(max(dot(R,V),0.0),se);gl_FragColor=ambientLight + diffuseLight + vec4(specularLight,1);}"),e.compileShader(o);var a=e.createProgram();return e.attachShader(a,r),e.attachShader(a,o),e.linkProgram(a),a}function init(){var e=document.getElementById("myGLCanvas");gl=e.getContext("webgl")||e.getContext("experimental-webgl"),initGL(),installModel(o=luck(.1,128,128)),r=new TrackballRotator(e,draw,15);var t=0;!function e(){gl.uniform4f(u_lp,100*Math.cos(t),100*Math.sin(t),100,1),draw(),t+=.0625,requestAnimationFrame(e)}()}
        </script>
        <style>
	        #myGLCanvas {
	        	cursor: move;
	        }
	    </style>
    </head>
    <body onload="init()">
        <canvas width=700 height=700 id="myGLCanvas"></canvas>
    </body>
</html>
